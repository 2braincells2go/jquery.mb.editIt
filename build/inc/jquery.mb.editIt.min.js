/*jquery.mb.editIt - 08-10-2015
 _ Copyright (c) 2015. Matteo Bicocchi (Pupunzi)
 */
function _(a,b){var c=$.editIt.i18n,d=c.default_lang||navigator.language||navigator.userLanguage,e=a;if(c[d]&&c[d][a]&&(e=c[d][a]),b)for(var f in b)e=e.replace("%%",b[f]);return e}!function(a){a.editIt={author:"Matteo Bicocchi (Pupunzi)",version:"1.1.0",defaults:{textareaId:null,pasteAs:"cleanHTML",blockImages:!0,enablePreview:!0,toolBar:"default",toolBarIcon:!0,enableSourceMode:!0,styleWithCSS:!1,defaultLang:"it-IT"},toolBar:{none:"","default":["paragraph","|","bold","italic","underline","strikeThrough","|","justifyLeft","justifyCenter","justifyRight","justifyFull","|","removeFormat","|","createlink","|","insertOrderedList","insertUnorderedList","|","outdent","indent","|","undo","redo"],small:["bold","italic","underline","strikeThrough","removeFormat","|","undo","redo"],draw:function(b,c){if(a(b).is("[contenteditable]")&&b.editorsContainer){a.extend(b.editorsContainer.cmnds,a.editIt.commands),a.extend(b.editorsContainer.opt.toolBar,a.editIt.defaults.toolBar),a.editIt.toolBar.clear(b);var d=a.editIt.toolBar.getElements(b);b.editorsContainer.toolBar=a("<div/>").addClass("editIt-toolbar").attr({id:"editIt-toolbar"});for(var e in d){var f=d[e].trim();if("|"!=f){var g=b.editorsContainer.cmnds[f];if(g&&(!g.availableFor||a.editIt.util.isSelectionInsideElement(g.availableFor))){var h=b.editorsContainer.opt.toolBarIcon&&g.icon,i=h?"":g.label,j=a("<button>").html(_(i)).data("action",f).addClass((h?"icon ":"textual ")+f);h&&(j.addClass(g.icon),j.attr({title:_(g.label)})),g.type||(g.type="default");var k="undefined"!=typeof document.queryCommandState;switch(g.type){case"dropdown":var l=a("<span/>").addClass("editIt-icon-sort-desc").css({paddingLeft:10});j[0].isDropDown=!0,j.append(l);break;case"plugin":try{k&&document.queryCommandState(f)&&j.addClass("sel")}catch(m){console.debug(m)}break;default:try{k&&!document.queryCommandEnabled(f)&&j.addClass("disabled"),(k&&"createlink"==f&&a.editIt.util.isSelectionInsideElement("A")||"removeFormat"!=f&&document.queryCommandState(f))&&j.addClass("sel")}catch(m){console.debug(m)}}j.on("mousedown",function(c){c.stopPropagation();var d=this,e=a(d);clearTimeout(a.editIt.hidetimer),setTimeout(function(){a(b).focus();var c=[b];b.editorsContainer.cmnds[e.data("action")].action.apply(d,c),d.isDropDown||(a.editIt.toolBar.draw(b),b.editorsContainer.opt.textareaId&&b.editorsContainer.textarea.val(a.editIt.util.getClearContent(b.editorsContainer)))},50)}),b.editorsContainer.toolBar.append(j)}}else{var n=a("<span/>").addClass("separator").html("&nbsp;");b.editorsContainer.toolBar.append(n)}}c?b.editorsContainer.toolBar.fadeIn(200):b.editorsContainer.toolBar.show(),b.editorsContainer.toolBar.unselectable();var o=a(window).scrollLeft(),p=a(window).scrollTop(),q=a.editIt.util.getSelectionCoords();a("body").after(b.editorsContainer.toolBar);var l=a("<div/>").addClass("arrow_box");b.editorsContainer.toolBar.append(l),q.left=q.left-b.editorsContainer.toolBar.outerWidth()/2,q.top=q.top-20;var r=q.left-o+b.editorsContainer.toolBar.width()<a(window).width(),s=q.top-p+b.editorsContainer.toolBar.height()<a(window).height();q.left=r?q.left:q.left-(q.left-o+b.editorsContainer.toolBar.width()-a(window).width())-10,q.left=q.left>10?q.left:10,q.top=s?q.top:q.top-(q.top-p+b.editorsContainer.toolBar.height()-a(window).height())-10,q.top=q.top<=p+b.editorsContainer.toolBar.height()?q.top+b.editorsContainer.toolBar.outerHeight()+20:q.top,b.editorsContainer.toolBar.css({left:q.left,top:q.top}),l.css({left:a.editIt.util.getSelectionCoords().left-b.editorsContainer.toolBar.position().left+q.width/2-5,top:q.top-b.editorsContainer.toolBar.position().top+b.editorsContainer.toolBar.outerHeight()-10}),a(".editIt-tooltip").remove()}},clear:function(a){a&&a.editorsContainer&&a.editorsContainer.toolBar&&a.editorsContainer.toolBar.is(":visible")&&a.editorsContainer.toolBar.remove()},getElements:function(b){var c=a.editIt.toolBar[a(b).data("toolbar")||b.editorsContainer.opt.toolBar].slice(0);b.actualTag=a.editIt.util.getSelectedElement();var d=a.editIt.util.isSelectionInsideElement("A");return d&&c.indexOf("createlink")>0&&c.splice(c.indexOf("createlink")+1,0,"unlink"),c},add:function(b,c){a.editIt.toolBar[b]=c},extend:function(b,c,d){var e=a.editIt.toolBar[b];e.indexOf(c)<0&&e.splice(d,0,c)}},commands:{extend:function(b,c){if("object"==typeof b){var c=b;for(var d in c){var b=d,e=c[d];a.editIt.commands[b]=e}}else a.editIt.commands[b]=c},redo:{label:"Redo",icon:"editIt-icon-mail-forward",action:function(a){document.queryCommandEnabled("redo")&&document.execCommand("redo",!1,null)}},undo:{label:"Undo",icon:"editIt-icon-mail-reply",action:function(a){document.queryCommandEnabled("undo")&&document.execCommand("undo",!1,null)}},bold:{label:"Bold",icon:"editIt-icon-bold",action:function(a){document.execCommand("bold",!1,null)}},italic:{label:"Italic",icon:"editIt-icon-italic",action:function(a){document.execCommand("italic",!1,null)}},underline:{label:"Underline",icon:"editIt-icon-underline",action:function(a){document.execCommand("underline",!1,null)}},strikeThrough:{label:"Stroke",icon:"editIt-icon-strikethrough",action:function(a){document.execCommand("strikeThrough",!1,null)}},removeFormat:{label:"Clear",icon:"editIt-icon-eraser",action:function(a){document.execCommand("removeFormat",!1,null)}},createlink:{label:"Link",icon:"editIt-icon-chain",action:function(b){var c=document.getSelection().toString(),d=self.location.href;c.length>30&&(c=c.substring(0,28)+"...");var e="A"==b.actualTag.tagName.toUpperCase()?b.actualTag.href.replace(document.URL,"").replace(document.location.origin,""):"http://",f="A"==b.actualTag.tagName.toUpperCase()?b.actualTag.title:"",g="A"==b.actualTag.tagName.toUpperCase()&&b.actualTag.target?"checked":"";promptContent="<h2>"+_("Write here the URL for:")+" <span style='opacity:.6'>"+c+"</span></h2> \n<input type='text' id='editItlink' name='link' placeholder='http://' value='"+e+"'><br><br><input type='text' id='editItlinkTitle' name='title' placeholder='"+_("Add a title")+"' value='"+f+"'><br><br><input type='checkbox' id='editItlinkTarget' name='target' value='_blank' "+g+"> <label for='editItlinkTarget'>"+_("Open the link in a new window")+"</label>",a.editIt.prompt.draw(b,promptContent,null,function(a){if(a.link&&"http://"!=a.link){var b=a.link.replace(d,"");document.execCommand("createlink",!1,b),a.target&&(document.getSelection().anchorNode.parentNode.target=a.target),a.title&&(document.getSelection().anchorNode.parentNode.title=a.title)}else document.execCommand("unlink",!1,"")})}},justifyFull:{label:"Justify",icon:"editIt-icon-align-justify",action:function(a){document.execCommand("justifyFull",!1,"")}},justifyCenter:{label:"Center",icon:"editIt-icon-align-center",action:function(a){document.execCommand("justifyCenter",!1,"")}},justifyLeft:{label:"Left",icon:"editIt-icon-align-left",action:function(a){document.execCommand("justifyLeft",!1,"")}},justifyRight:{label:"Right",icon:"editIt-icon-align-right",action:function(a){document.execCommand("justifyRight",!1,"")}},unlink:{label:"Unlink",icon:"editIt-icon-chain-broken",action:function(a){document.execCommand("unlink",!1,"")}},paragraph:{label:"Paragraph",icon:!1,type:"dropdown",action:function(b){var c=["h1","h2","h3","h4","p","blockquote"];a.editIt.dropDown.draw.apply(this,[b,c])}},h1:{label:"Title H1",icon:!1,action:function(a){document.execCommand("formatBlock",!1,"<H1>")}},h2:{label:"Title H2",icon:!1,action:function(){document.execCommand("formatBlock",!1,"<H2>")}},h3:{label:"Title H3",icon:!1,action:function(){document.execCommand("formatBlock",!1,"<H3>")}},h4:{label:"Title H4",icon:!1,action:function(){document.execCommand("formatBlock",!1,"<H4>")}},p:{label:"Paragraph P",icon:!1,action:function(){document.execCommand("formatBlock",!1,"<P>")}},blockquote:{label:"Blockquote",icon:"editIt-icon-quote-left",action:function(){document.execCommand("formatBlock",!1,"<BLOCKQUOTE>")}},insertOrderedList:{label:"Ordered list",icon:"editIt-icon-list-ol",action:function(a){document.execCommand("insertOrderedList",!1,null)}},insertUnorderedList:{label:"Unordered list",icon:"editIt-icon-list-ul",action:function(a){document.execCommand("insertUnorderedList",!1,null)}},indent:{label:"Indent",icon:"editIt-icon-indent",action:function(a){document.execCommand("indent",!1,null)}},outdent:{label:"Outdent",icon:"editIt-icon-dedent",action:function(a){document.execCommand("outdent",!1,null)}}},plugins:{load:function(b){a(document).on("registered",function(a){a.plugin.UID=b.asId(),a.plugin.path=b}),jQuery.ajax({async:!1,type:"GET",url:b+"/plugin.js?_="+(new Date).getTime(),data:null,dataType:"script",error:function(){a.editIt.alert.draw(null,_("There's been an error loading the plugin:<br> %%",[b]))}})},register:function(b,c){a.editIt._plugins=a.editIt.plugins||{},a.editIt._plugins[b.name]=b;var d=a.Event("registered");d.plugin=a.editIt._plugins[b.name],a(document).trigger(d),b.i18n&&a.editIt.i18n.extend(b.i18n),a.editIt._plugins[b.name].activate.apply(d.plugin)}},mainButtonBar:{draw:function(b){a(".editIt-main-buttonBar").remove(),b._buttonBar=b._buttonBar||{},b.mainButtonBar=a("<div/>").addClass("editIt-main-buttonBar"),a(b).append(b.mainButtonBar);var c=a.Event("editIt-create-mainBB");c.editor=b,a(b).trigger(c)},clear:function(){a(".editIt-main-buttonBar").remove()},addButton:function(b,c){var d={label:"button",icon:!1,className:null,action:function(){}};a.extend(d,c);var e=a.editIt.util.drawButton(d.label,"main-color "+d.className||"",d.icon,function(a){a.preventDefault(),d.action.apply(b,[b])});b.mainButtonBar.append(e),b._buttonBar[d.label]=e}},alert:{draw:function(b,c){b||(b=a.editIt.actualEditor),b.actualSelection=a.editIt.util.saveSelection(),a.editIt.toolBar.clear(b),b.alert=a("<div/>").addClass("editIt-alert").hide();var d=a("<div/>").addClass("editIt-alert-box"),e=a("<div/>").addClass("editIt-alert-buttonBar"),f=a.editIt.util.drawButton("Ok","apply","editIt-icon-check big",function(c){b.alert.remove(),a("body").removeClass("blur"),setTimeout(function(){a.editIt.toolBar.draw(b),a(b).focus()},50),a(document).off("keydown.alert")});e.append(f),d.append(c),b.alert.append(d),d.append(e),a("body").after(b.alert),a("body").addClass("blur"),b.alert.fadeIn(120),a(document).on("keydown.alert",function(a){var b=a.keyCode;switch(b){case 13:a.preventDefault(),f.mouseup()}})}},prompt:{draw:function(b,c,d,e,f,g){b.actualSelection=a.editIt.util.saveSelection(),b.prompt=a("<div/>").addClass("editIt-prompt").hide();var h=a("<div/>").addClass("editIt-prompt-box"),i=a.editIt.util.drawButton("Cancel","text-modality",null,null),j=a.editIt.util.drawButton(f||"Apply",(g||"apply")+" big",null,null),k=a("<div/>").addClass("editIt-prompt-buttonBar");k.append(i).append(j),h.append(c),j.on("click",function(){var c={};a("input",b.prompt).each(function(){switch(this.type){case"checkbox":a(this).is(":checked")&&(c[this.name]=a(this).val());break;case"radio":a(this).is(":checked")&&(c[this.name]=a(this).val());break;default:c[this.name]=a(this).val()}}),a.editIt.util.restoreSelection(b.actualSelection),e(c),b.prompt.remove(),a("body").removeClass("blur"),setTimeout(function(){a.editIt.toolBar.draw(b),a(b).focus()},50),a(document).off("keydown.prompt")}),i.on("click",function(){b.prompt.remove(),a("body").removeClass("blur"),a.editIt.util.restoreSelection(b.actualSelection),a.editIt.toolBar.draw(b,!0),a(document).off("keydown.prompt")}),b.prompt.append(h),h.append(k),a("body").after(b.prompt),a("body").addClass("blur"),"function"==typeof a.editIt.prompt.onLoad&&(a.editIt.prompt.onLoad(b,d),a.editIt.prompt.onLoad=null),b.prompt.fadeIn(300,function(){h.find("input").eq(0).focus().select()}),a(document).on("keydown.prompt",function(a){var b=a.keyCode;switch(b){case 13:a.preventDefault(),j.click();break;case 27:a.preventDefault(),i.click()}})},onLoad:function(a,b){}},tooltip:{draw:function(b,c,d){a(".editIt-tooltip").remove(),b.tooltip=a("<div/>").addClass("editIt-tooltip").hide(),b.tooltip.append(c),a("body").append(b.tooltip);var e=a.editIt.util.getSelectionCoords();d&&(e.left-=b.tooltip.outerWidth()/2),b.tooltip.css({left:e.left,top:e.top}),b.tooltip.slideDown(300)}},dropDown:{draw:function(b,c){var d=this,e=a(".editIt-dropdown");if(e.is(":visible")){var f=e[0].opener;if(e.remove(),f==d)return}clearTimeout(a.editIt.hidetimer),b.dropDown=a("<div/>").addClass("editIt-dropdown"),b.dropDown[0].opener=d,b.dropDown.css({position:"absolute",left:a(d).position().left,marginTop:0}),a(b).focus(),b.actualSelection=a.editIt.util.saveSelection();for(var g in c)if("-"!=c[g]){var h=b.editorsContainer.cmnds[c[g]];if(h&&(!h.availableFor||a.editIt.util.isSelectionInsideElement(h.availableFor))){var i=h.icon?"<span class='"+h.icon+"'></span>":"",j=a("<div/>").addClass("row"+c[g]).html(_(h.label)+" "+i).data("action",c[g]);b.dropDown.append(j),j.on("mousedown",function(){var c=a(this);b.actualSelection=a.editIt.util.saveSelection(),setTimeout(function(){var d=[b];a.editIt.util.restoreSelection(b.actualSelection),b.editorsContainer.cmnds[c.data("action")].action.apply(c[0],d),a(b).focus(),a.editIt.toolBar.draw(b)},50)})}}else{var k=a("<div/>").addClass("row_separator");b.dropDown.append(k)}a(d).after(b.dropDown)}},util:{getContent:function(b){a.editIt.util.setUneditable(b);var c=a(b).html(),d=a(b)[0].editorsContainer.opt;return a(a(b)[0].editorsContainer).editIt(d),c},getClearContent:function(b){if(b||b.editorsContainer){var c=a(b.editorsContainer).clone();return a("[id*=editIt_]",c).removeAttr("id"),a(".editIt-main-buttonBar",c).remove(),a("[data-editable]",c).removeClass("editIt").removeAttr("contenteditable"),a(".editIt-wrapper",c).removeClass("inEditMode"),a(".focusedEditor",c).removeClass("focusedEditor"),a(".editIt-buttonBar",c).remove(),c.html()}},setUneditable:function(b){var c=a.Event("editIt-remove");c.editor=b,a(b).trigger(c),a.editIt.mainButtonBar.clear(),a.editIt.toolBar.clear(b),a("[id*=editIt_]").removeAttr("id"),a("[data-editable]",a(b)).removeClass("editIt").removeAttr("contenteditable").off(),a(".editIt-wrapper").removeClass("inEditMode"),a(".editIt-buttonBar").remove()},handlePaste:function(b,c){b=b.originalEvent||b;var d="";if(b&&b.clipboardData&&b.clipboardData.getData&&(/text\/html/.test(b.clipboardData.types)?d=b.clipboardData.getData("text/html"):/text\/plain/.test(b.clipboardData.types)?d=b.clipboardData.getData("text/plain"):d.innerHTML=""),console.debug(d),c.editorsContainer.opt.pasteAs&&(b.preventDefault&&(b.stopPropagation(),b.preventDefault()),"none"!=c.editorsContainer.opt.pasteAs)){if(c.editorsContainer.opt.blockImages){var e=a("<div/>").html(d),f=e.find("img");f.length&&(a.editIt.alert.draw(c,_("<b>Attention!</b><br><br> Images insertion has been disabled in this editor.<br><br> <b>%%</b> images have been removed from the pasted source.",[f.length])),f.remove(),d=e.html(),e.remove())}"text"==c.editorsContainer.opt.pasteAs||b.shiftKey?(d.replace(/<br>/g,"\n"),d=a(d).text()):"cleanHTML"==c.editorsContainer.opt.pasteAs&&(d=a.htmlClean(d)),document.execCommand("insertHTML",!1,d)}},enablePreview:function(){var b=this;a.editIt.mainButtonBar.addButton(b,{label:_("Preview"),icon:"editIt-icon-eye",action:function(b){b.editorsContainer.previewMode=!0;var c=a("<div/>").addClass("editIt-preview").hide(),d=a("<div/>").html(a.editIt.util.getClearContent(b)).addClass("preview-content");c.append(d);var e=a.Event("editIt-preview");e.content=c,a(document).trigger(e);var f=a.editIt.util.drawButton("Close","previewMode-close main-color big","editIt-icon-close",function(){c.slideUp(400,function(){a(this).remove(),a("body").removeClass("blur")});var d=b.editorsContainer.opt;a(b.editorsContainer).editIt(d)});c.append(f),a("body").after(c),a("body").addClass("blur"),c.slideDown(400,function(){a.editIt.util.setUneditable(b.editorsContainer)})}})},enableSourceMode:function(){var b=this,c=a(b),d=function(){b.mainButtonBar&&b.mainButtonBar.remove(),c.addClass("inSourceMode"),a("body").addClass("inSourceMode"),b.isInSourceMode=!0,a.editIt.util.setUneditable(b.editorsContainer);var d=c.html();b.sourceMode&&b.sourceMode.remove(),b.editorsContainer.buttonBar&&b.editorsContainer.buttonBar.remove(),a("#HTML_"+b.id).remove();var e=a("<div/>").addClass("editIt-source-overlay").css({position:"fixed",top:0,left:0,bottom:0,right:0,margin:"auto"}),f=a("<div/>").addClass("editIt-source").attr({id:"HTML_"+b.id}),g=a("<textarea/>"),h=a.editIt.util.drawButton("Close","white align-right","editIt-icon-close",function(){b.isInSourceMode=!1;var d=b.editorsContainer.opt;a(b.editorsContainer).editIt(d),c.removeClass("inSourceMode"),a("body").removeClass("inSourceMode"),f.removeClass("in"),e.delay(10).removeClass("in"),setTimeout(function(){f.remove(),e.remove()},1e3)});g.html(d),f.append(g),f.data("owner",b),a("body").append(e).append(f),f.prepend(h),setTimeout(function(){f.addClass("in"),e.addClass("in"),g.focus()},100),g.on("change mouseup keyup",function(){var b=a(this).val();c.html(b)})};a(b.editorsContainer).is(b)?a.editIt.mainButtonBar.addButton(b,{label:_("Edit source"),icon:"editIt-icon-code",action:function(){d()}}):(b.sourceMode=a.editIt.util.drawButton("Edit source","align-right","editIt-icon-code",d),b.buttonBar&&b.buttonBar.append(b.sourceMode))},drawButton:function(b,c,d,e,f,g){c=c?" "+c:"",d=d?" "+d:"";var h=a("<button/>").attr({label:g?"":_(b),title:g?_(b):""}).addClass("editIt-button"+c+d+(g?" onlyIcon":""));return e&&h.on("click",function(a){e(a)}),f&&h.data(f.key,f.value),h},getSelectionCoords:function(){var b,c,d=document.selection,e=0,f=0,g=0;if(d)"Control"!=d.type&&(b=d.createRange(),b.collapse(!0),e=b.boundingLeft,f=b.boundingTop);else if(window.getSelection&&(d=window.getSelection(),d.rangeCount)){if(b=d.getRangeAt(0).cloneRange(),b.getClientRects&&b.getClientRects().length>0){var h=b.getClientRects();c=1==h.length?h[0]:h[1],e=c.left,f=c.top,g=c.right-c.left}if(0==e&&0==f){var i=document.createElement("span");if(i.getClientRects){i.appendChild(document.createTextNode("​")),b.insertNode(i),c=i.getClientRects()[0],e=c.left,f=c.top;var j=i.parentNode;j.removeChild(i),j.normalize()}}}var k=a(window).scrollLeft(),l=a(window).scrollTop();return{left:e+k,top:f+l,width:g}},getSelectedText:function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().text:""},getSelectedElement:function(){var a,b;for(a=window.getSelection(),a.focusNode&&(b=a.focusNode.children?a.focusNode.children[0]:a.focusNode.actualTag||a.focusNode.parentNode),a.rangeCount>0&&(b=a.getRangeAt(0).commonAncestorContainer);b;){if(1==b.nodeType)return b;b=b.parentNode}return!1},isSelectionInsideElement:function(a){var b,c;for(a=a.toUpperCase(),b=window.getSelection(),b.rangeCount>0&&(c=b.getRangeAt(0).commonAncestorContainer),b.focusNode&&(c=b.focusNode.children?b.focusNode.children[0]:b.focusNode.actualTag||b.focusNode.parentNode);c;){if(1==c.nodeType&&c.tagName.toUpperCase()==a)return c;c=c.parentNode}return!1},saveSelection:function(){if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount)return sel.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restoreSelection:function(a){a&&(window.getSelection?(sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(a)):document.selection&&a.select&&a.select())},selectElementContents:function(a){var b=document.createRange();b.selectNodeContents(a);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)},fullScreen:function(a){a.addClass("full-screen")}},init:function(b,c){return this.each(function(){var d=this,e=a(d);e.off(),d.opt={},d.cmnds={},d.editorsContainer=d,a.extend(d.opt,a.editIt.defaults,b),a.extend(d.cmnds,a.editIt.commands,c),a.editIt.i18n.default_lang=d.opt.defaultLang,d.editItIdx||(d.editItIdx=d.id||"editIt_"+(new Date).getTime(),a.editIt.editors=a.editIt.editors||{},a.editIt.editors[d.editItIdx]={},a.editIt.editors[d.editItIdx].opt=d.opt),a.extend(d.opt,a.editIt.editors[d.editItIdx].opt),a.editIt.mainButtonBar.draw(d),"static"==e.css("position")&&e.css("position","relative"),d.opt.textareaId=e.data("for")||d.opt.textareaId,d.opt.textareaId&&(d.textarea=a("#"+d.opt.textareaId),d.textarea.hide()),d.opt.enableSourceMode&&a.editIt.util.enableSourceMode.apply(d),d.opt.enablePreview&&a.editIt.util.enablePreview.apply(d),a(d).addClass("editIt-wrapper inEditMode"),"static"==e.css("position")&&e.css("position","relative");var f=e.is("[data-editable]")?a(this):a("[data-editable]",e);f.each(function(){var b=this,c=a(b);c.off(),"static"==c.css("position")&&c.css("position","relative"),b.buttonBar=a("<div/>").addClass("editIt-buttonBar"),c.prepend(b.buttonBar),c.parents().is("[data-editable]")||(c.data("enablesourcemode")&&a.editIt.util.enableSourceMode.apply(b),b.id||(b.id="editIt_"+(new Date).getTime()),b.editorsContainer=d.editorsContainer,c.addClass("editIt"),c.attr("contenteditable",!0),d.opt.styleWithCSS&&document.execCommand("styleWithCSS",!1,null),c.on("paste",function(c){a.editIt.util.handlePaste(c,b)}).on("mousedown",function(d){b.actualTag=d.target,a(document).one("mouseup",function(){c.trigger("mouseup")});var e=a.Event("editIt-mousedown");e.editor=b,c.trigger(e)}).on("mouseup keyup",function(d){d.stopPropagation(),clearTimeout(b.mouseupTimer),b.actualTag=d.target,a.editIt.actualEditor=b.editorsContainer,b.mouseupTimer=setTimeout(function(){if(0==a.editIt.util.getSelectedText().length){a.editIt.toolBar.clear(b),a(".editIt-tooltip").remove();var d="A"==b.actualTag.tagName.toUpperCase();if(d){var e=b.actualTag.href;a.editIt.tooltip.draw.apply(b.actualTag,[b,"<a href='"+e+"' target='_blank'>"+e+"</a>",!0])}}else clearTimeout(a.editIt.hidetimer),a(".editIt-dropdown").is(":visible")||a.editIt.toolBar.draw(b);var f=a.Event("editIt-mouseup");f.editor=b,c.trigger(f)},"mouseup"==d.type?50:500)}).on("focus",function(){b.editorsContainer.toolBar&&b.editorsContainer.toolBar.is(":visible")&&clearTimeout(a.editIt.hidetimer),a(".focusedEditor").removeClass("focusedEditor"),a(this).addClass("focusedEditor"),b.buttonBar&&b.buttonBar.fadeIn(100);var d=a.Event("editIt-focus");d.editor=b,c.trigger(d)}).on("blur",function(){a.editIt.hidetimer=setTimeout(function(){a.editIt.toolBar.clear(b),b.buttonBar&&b.buttonBar.fadeOut(100),a(".focusedEditor").removeClass("focusedEditor"),setTimeout(function(){a(".editIt-tooltip").remove()},30);var d=a.Event("editIt-blur");d.editor=b,c.trigger(d)},150)}).on("keydown",function(d){var e=d.keyCode;switch(e){case 8:a.editIt.toolBar.clear(b);break;case 13:var f=a.editIt.util.isSelectionInsideElement("OL")||a.editIt.util.isSelectionInsideElement("UL");if(f)return;d.preventDefault();var g=window.getSelection(),h=g.getRangeAt(0),i=document.createElement("br"),j=document.createTextNode(" ");h.collapse(!1),h.insertNode(j),h.insertNode(i),h.selectNodeContents(j),g.removeAllRanges(),g.addRange(h),document.execCommand("forwardDelete",!1,null),d.shiftKey||document.execCommand("formatBlock",!1,"p");break;case 65:(d.ctrlKey||d.metaKey)&&setTimeout(function(){a.editIt.toolBar.draw(b)},50);break;case 66:(d.ctrlKey||d.metaKey)&&(document.execCommand("bold",!1,null),d.preventDefault());break;case 73:(d.ctrlKey||d.metaKey)&&(document.execCommand("italic",!1,null),d.preventDefault());break;case 85:(d.ctrlKey||d.metaKey)&&(document.execCommand("underline",!1,null),d.preventDefault());break;default:a.editIt.toolBar.clear(b)}var k=a.Event("editIt-keyup");k.editor=b,k.key=e,c.trigger(k)}).on("keyup",function(){d.editorsContainer.opt.textareaId&&b.editorsContainer.textarea.val(a.editIt.util.getClearContent(b.editorsContainer))}).on("mouseover",function(d){var e=d.target,f=a(e);if(f.parents(".focusedEditor").length){switch(e.tagName.toUpperCase()){case"IMG":break;case"TD":break;case"A":f.click()}b.hoverTag=e.tagName.toUpperCase();var g=a.Event("editIt-mouseover");g.editor=b,g.hoverElement=e,c.trigger(g)}}))});var g=a.Event("editIt-apply");g.editor=d,a(document).trigger(g),d.editorsContainer.opt.textareaId&&d.editorsContainer.textarea.val(a.editIt.util.getClearContent(d))})}},a.fn.editIt=a.editIt.init,a.fn.sourceMode=a.editIt.sourceMode}(jQuery),$.fn.unselectable=function(){return this.each(function(){$(this).css({"-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).attr("unselectable","on")})},$.fn.selectable=function(){return this.each(function(){$(this).css({"-moz-user-select":"text","-webkit-user-select":"text","user-select":"text"}).removeAttr("unselectable")})},String.prototype.asId=function(){return this.replace(/[^a-zA-Z0-9_]+/g,"")},!function(a){function b(a,b,c,d){if(a.tag.format&&c.length>0){c.push("\n");for(var e=0;d>e;e++)c.push("	")}}function c(d,e){var f=[],g=0==d.attributes.length,h=0;if(d.tag.isComment)e.allowComments&&(f.push("<!--"),f.push(d.tag.rawAttributes),f.push(">"),e.format&&b(d,e,f,h-1));else{var i=d.tag.render&&(0==e.allowedTags.length||a.inArray(d.tag.name,e.allowedTags)>-1)&&(0==e.removeTags.length||-1==a.inArray(d.tag.name,e.removeTags));if(!d.isRoot&&i&&(f.push("<"),f.push(d.tag.name),a.each(d.attributes,function(){if(-1==a.inArray(this.name,e.removeAttrs)){var b=RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),c=b[2],g=b[1]||"'";"class"==this.name&&e.allowedClasses.length>0&&(c=a.grep(c.split(" "),function(b){return a.grep(e.allowedClasses,function(c){return c==b||c[0]==b&&(1==c.length||a.inArray(d.tag.name,c[1])>-1)}).length>0}).join(" ")),null!=c&&(c.length>0||a.inArray(this.name,d.tag.requiredAttributes)>-1)&&(f.push(" "),f.push(this.name),f.push("="),f.push(g),f.push(c),f.push(g))}})),d.tag.isSelfClosing)i&&f.push(" />"),g=!1;else if(d.tag.isNonClosing)g=!1;else{if(!d.isRoot&&i&&f.push(">"),h=e.formatIndent++,d.tag.toProtect)n=a.htmlClean.trim(d.children.join("")).replace(/<br>/gi,"\n"),f.push(n),g=0==n.length;else{for(var n=[],p=0;p<d.children.length;p++){var q=d.children[p],r=a.htmlClean.trim(o(l(q)?q:q.childrenToString()));m(q)&&p>0&&r.length>0&&(j(q)||k(d.children[p-1]))&&n.push(" "),l(q)?r.length>0&&n.push(r):(p!=d.children.length-1||"br"!=q.tag.name)&&(e.format&&b(q,e,n,h),n=n.concat(c(q,e)))}e.formatIndent--,n.length>0&&(e.format&&"\n"!=n[0]&&b(d,e,f,h),f=f.concat(n),g=!1)}!d.isRoot&&i&&(e.format&&b(d,e,f,h-1),f.push("</"),f.push(d.tag.name),f.push(">"))}if(!d.tag.allowEmpty&&g)return[]}return f}function d(b,c){return f(b,function(b){return a.inArray(b.tag.nameOriginal,c)>-1})}function e(a){return f(a,function(a){return a.isRoot||!a.tag.isInline})}function f(a,b,c){c=c||1;var d=a[a.length-c];return b(d)?!0:a.length-c>0&&f(a,b,c+1)?(a.pop(),!0):!1}function g(a){return a?(this.tag=a,this.isRoot=!1):(this.tag=new i("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(a){for(var b=0;b<this.attributes.length;b++)if(this.attributes[b].name==a)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function h(a,b){return this.name=a,this.value=b,this}function i(b,c,d,e){return this.name=b.toLowerCase(),this.nameOriginal=this.name,this.render=!0,this.init=function(){if("--"==this.name?(this.isComment=!0,this.isSelfClosing=!0,this.format=!0):(this.isComment=!1,this.isSelfClosing=a.inArray(this.name,v)>-1,this.isNonClosing=a.inArray(this.name,w)>-1,this.isClosing=void 0!=c&&c.length>0,this.isInline=a.inArray(this.name,p)>-1,this.disallowNest=a.inArray(this.name,r)>-1,this.requiredParent=t[a.inArray(this.name,t)+1],this.allowEmpty=e&&a.inArray(this.name,e.allowEmpty)>-1,this.toProtect=a.inArray(this.name,u)>-1,this.format=a.inArray(this.name,q)>-1||!this.isInline),this.rawAttributes=d,this.requiredAttributes=y[a.inArray(this.name,y)+1],e){if(e.tagAttributesCache||(e.tagAttributesCache=[]),-1==a.inArray(this.name,e.tagAttributesCache)){for(var b=x[a.inArray(this.name,x)+1].slice(0),f=0;f<e.allowedAttributes.length;f++){var g=e.allowedAttributes[f][0];(1==e.allowedAttributes[f].length||a.inArray(this.name,e.allowedAttributes[f][1])>-1)&&-1==a.inArray(g,b)&&b.push(g)}e.tagAttributesCache.push(this.name),e.tagAttributesCache.push(b)}this.allowedAttributes=e.tagAttributesCache[a.inArray(this.name,e.tagAttributesCache)+1]}},this.init(),this.rename=function(a){this.name=a,this.init()},this}function j(b){for(;n(b)&&b.children.length>0;)b=b.children[0];if(!l(b))return!1;var c=o(b);return c.length>0&&a.htmlClean.isWhitespace(c.charAt(0))}function k(b){for(;n(b)&&b.children.length>0;)b=b.children[b.children.length-1];if(!l(b))return!1;var c=o(b);return c.length>0&&a.htmlClean.isWhitespace(c.charAt(c.length-1))}function l(a){return a.constructor==String}function m(a){return l(a)||a.tag.isInline}function n(a){return a.constructor==g}function o(a){return a.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}a.fn.htmlClean=function(b){return this.each(function(){this.value?this.value=a.htmlClean(this.value,b):this.innerHTML=a.htmlClean(this.innerHTML,b)})},a.htmlClean=function(b,f){f=a.extend({},a.htmlClean.defaults,f),f.allowEmpty=s.concat(f.allowEmpty);var j,k=/(<(\/)?(\w+:)?([\w]+)([^>]*)>)|<!--(.*?--)>/gi,m=/([\w\-]+)\s*=\s*(".*?"|'.*?'|[^\s>\/]*)/gi,n=new g,o=[n],p=n;f.bodyOnly&&(j=/<body[^>]*>((\n|.)*)<\/body>/i.exec(b))&&(b=j[1]),b=b.concat("<xxx>");for(var q;j=k.exec(b);){var r=j[6]?new i("--",null,j[6],f):new i(j[4],j[2],j[5],f),t=b.substring(q,j.index);if(t.length>0){var u=p.children[p.children.length-1];p.children.length>0&&l(u=p.children[p.children.length-1])?p.children[p.children.length-1]=u.concat(t):p.children.push(t)}if(q=k.lastIndex,r.isClosing)d(o,[r.name])&&(o.pop(),p=o[o.length-1]);else{for(var v,w=new g(r);v=m.exec(r.rawAttributes);){if("style"==v[1].toLowerCase()&&f.replaceStyles)for(var x=!r.isInline,y=0;y<f.replaceStyles.length;y++)f.replaceStyles[y][0].test(v[2])&&(x||(r.render=!1,x=!0),p.children.push(w),o.push(w),p=w,r=new i(f.replaceStyles[y][1],"","",f),w=new g(r));null!=r.allowedAttributes&&(0==r.allowedAttributes.length||a.inArray(v[1],r.allowedAttributes)>-1)&&w.attributes.push(new h(v[1],v[2]))}a.each(r.requiredAttributes,function(){var a=this.toString();w.hasAttribute(a)||w.attributes.push(new h(a,""))});for(var z=0;z<f.replace.length;z++)for(var A=0;A<f.replace[z][0].length;A++){var B="string"==typeof f.replace[z][0][A];if(B&&f.replace[z][0][A]==r.name||!B&&f.replace[z][0][A].test(j)){r.rename(f.replace[z][1]),z=f.replace.length;break}}var C=!0;if(p.isRoot||(p.tag.isInline&&!r.isInline?(C=e(o))&&(p=o[o.length-1]):p.tag.disallowNest&&r.disallowNest&&!r.requiredParent?C=!1:r.requiredParent&&(C=d(o,r.requiredParent))&&(p=o[o.length-1])),C)if(p.children.push(w),r.toProtect)for(var D;D=k.exec(b);){var E=new i(D[4],D[1],D[5],f);if(E.isClosing&&E.name==r.name){w.children.push(RegExp.leftContext.substring(q)),q=k.lastIndex;break}}else r.isSelfClosing||r.isNonClosing||(o.push(w),p=w)}}return a.htmlClean.trim(c(n,f).join(""))},a.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],allowedAttributes:[],removeAttrs:["width","height","style"],allowedClasses:[],format:!1,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]],allowComments:!1,allowEmpty:[]},a.htmlClean.trim=function(b){return a.htmlClean.trimStart(a.htmlClean.trimEnd(b))},a.htmlClean.trimStart=function(b){return b.substring(a.htmlClean.trimStartIndex(b))},a.htmlClean.trimStartIndex=function(b){for(var c=0;c<b.length-1&&a.htmlClean.isWhitespace(b.charAt(c));c++);return c},a.htmlClean.trimEnd=function(b){return b.substring(0,a.htmlClean.trimEndIndex(b))},a.htmlClean.trimEndIndex=function(b){for(var c=b.length-1;c>=0&&a.htmlClean.isWhitespace(b.charAt(c));c--);return c+1},a.htmlClean.isWhitespace=function(b){return-1!=a.inArray(b,z)};var p=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","s","samp","select","option","param","small","span","strike","strong","sub","sup","tt","u","var"],q=["address","button","caption","code","input","label","legend","select","option","param"],r=["h1","h2","h3","h4","h5","h6","p","th","td","object"],s=["th","td"],t=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"],"param",["object"]],u=[],v=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],w=["!doctype","?xml"],x=["?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"iframe",["class","height","name","sandbox","seamless","src","srcdoc","width"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value","multiple"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme","charset"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"table",["class","summary"],"th",["class","colspan","rowspan"],"td",["class","colspan","rowspan"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"],"param",["name","value"],"embed",["height","src","type","width"]],y=[[],"img",["alt"]],z=[" "," ","	","\n","\r","\f"];
}(jQuery),$.editIt.i18n={},$.editIt.i18n["it-IT"]={"<b>Attention!</b><br><br> Images insertion has been disabled in this editor.<br><br> <b>%%</b> images have been removed from the pasted source.":"<b>Attenzione!</b><br><br> L'inserimento di immagini è disabilitato.<br>Sono state rimosse <b>%%</b> immagini dal codice incollato.","Edit source":"Edita il sorgente",Redo:"Rifai",Undo:"Annulla",Bold:"Grassetto",Italic:"Corsivo",Underline:"Sottolineato",Stroke:"Barrato",Clear:"Ripulisci",Link:"Link",Justify:"Giustificato",Center:"Centrato",Left:"Allineato a sinistra",Right:"Allineato a destra",Unlink:"Unlink",Paragraph:"Paragrafo","Title H1":"Titolo H1","Title H2":"Titolo H2","Title H3":"Titolo H3","Title H4":"Titolo H4","Paragraph P":"Paragrafo P",Blockquote:"Citazione","Ordered list":"Lista ordinata","Unordered list":"Lista",Indent:"Indenta",Outdent:"Elimina indentatura",Preview:"Anteprima",Close:"Chiudi",Apply:"Applica",Cancel:"Cancella",Delete:"Elimina","Write here the URL for:":"Inserisci qui la URL per:","Open the link in a new window":"Apri il link in una nuova finestra"},$.editIt.i18n.extend=function(a){for(var b in a)$.extend($.editIt.i18n[b],a[b])};var nAgt=navigator.userAgent;if(!jQuery.browser){jQuery.browser={},jQuery.browser.mozilla=!1,jQuery.browser.webkit=!1,jQuery.browser.opera=!1,jQuery.browser.safari=!1,jQuery.browser.chrome=!1,jQuery.browser.msie=!1,jQuery.browser.ua=nAgt,jQuery.browser.name=navigator.appName,jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10);var nameOffset,verOffset,ix;if(-1!=(verOffset=nAgt.indexOf("Opera")))jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8));else if(-1!=(verOffset=nAgt.indexOf("OPR")))jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+4);else if(-1!=(verOffset=nAgt.indexOf("MSIE")))jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",jQuery.browser.fullVersion=nAgt.substring(verOffset+5);else if(-1!=nAgt.indexOf("Trident")){jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer";var start=nAgt.indexOf("rv:")+3,end=start+4;jQuery.browser.fullVersion=nAgt.substring(start,end)}else-1!=(verOffset=nAgt.indexOf("Chrome"))?(jQuery.browser.webkit=!0,jQuery.browser.chrome=!0,jQuery.browser.name="Chrome",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(jQuery.browser.webkit=!0,jQuery.browser.safari=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("AppleWebkit"))?(jQuery.browser.webkit=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(jQuery.browser.mozilla=!0,jQuery.browser.name="Firefox",jQuery.browser.fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(jQuery.browser.name=nAgt.substring(nameOffset,verOffset),jQuery.browser.fullVersion=nAgt.substring(verOffset+1),jQuery.browser.name.toLowerCase()==jQuery.browser.name.toUpperCase()&&(jQuery.browser.name=navigator.appName));-1!=(ix=jQuery.browser.fullVersion.indexOf(";"))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),-1!=(ix=jQuery.browser.fullVersion.indexOf(" "))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),jQuery.browser.majorVersion=parseInt(""+jQuery.browser.fullVersion,10),isNaN(jQuery.browser.majorVersion)&&(jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10)),jQuery.browser.version=jQuery.browser.majorVersion}jQuery.browser.android=/Android/i.test(nAgt),jQuery.browser.blackberry=/BlackBerry|BB|PlayBook/i.test(nAgt),jQuery.browser.ios=/iPhone|iPad|iPod|webOS/i.test(nAgt),jQuery.browser.operaMobile=/Opera Mini/i.test(nAgt),jQuery.browser.windowsMobile=/IEMobile|Windows Phone/i.test(nAgt),jQuery.browser.kindle=/Kindle|Silk/i.test(nAgt),jQuery.browser.mobile=jQuery.browser.android||jQuery.browser.blackberry||jQuery.browser.ios||jQuery.browser.windowsMobile||jQuery.browser.operaMobile||jQuery.browser.kindle,jQuery.isMobile=jQuery.browser.mobile,jQuery.isTablet=jQuery.browser.mobile&&jQuery(window).width()>765,jQuery.isAndroidDefault=jQuery.browser.android&&!/chrome/i.test(nAgt);